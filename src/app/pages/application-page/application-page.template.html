<cp-application-component #applicationDetail>
  <div class="detail-card-container">
  <md-card *ngIf="applicationDetail.applicationDeployer">
    <md-toolbar class="detail-card-toolbar">
      <h3>{{ applicationDetail.applicationDeployer.name }}</h3>
      <span class="fill-remaining-space"></span>
      <span *ngIf="!applicationDetail.applicationDeployer.isShared">
        <button md-icon-button (click)="applicationDetail.shareApplicationDialogShowing=!applicationDetail.shareApplicationDialogShowing">
          <md-icon>share</md-icon> 
        </button>
        <button md-icon-button color="warn" (click)="applicationDetail.removeApplication(applicationDetail.applicationDeployer)">
          <md-icon>delete_forever</md-icon> 
        </button>
      </span>
      <span *ngIf="applicationDetail.applicationDeployer.isShared">
        <p>SHARED</p>
      </span>
    </md-toolbar>
    <md-card-content>
      <span class="flex-container-wide">
        <span class="flex-container-wide">
        <md-list dense>
          <md-list-item>
            <p>{{ applicationDetail.applicationDeployer.about }}</p>
          </md-list-item>
          <!--Application source-->
          <md-list-item>
            <h3 md-line>Source</h3>
            <p md-line class="param-value"><a href="{{ applicationDetail.applicationDeployer.repoUri }}">{{ applicationDetail.applicationDeployer.repoUri }}</a></p>
          </md-list-item>
          <md-list-item>
            <h3 md-line>Version</h3>
            <p md-line class="param-value">{{ applicationDetail.applicationDeployer.version }}</p>
          </md-list-item>
          <md-list-item>
            <h3 md-line>Contact</h3>
            <p md-line class="param-value">{{ applicationDetail.applicationDeployer.contact }}</p>
          </md-list-item>
          <md-list-item>
            <h3 md-line>Available for</h3>
            <p md-line class="param-value" *ngFor="let cloudProvider of applicationDetail.applicationDeployer.cloudProviders">
            {{ cloudProvider.cloudProvider }}</p>
          </md-list-item>
        </md-list>
        <md-list dense>
          <span *ngIf="applicationDetail.applicationDeployer.isShared">
            <md-list-item>
              <h3 md-line>Owned by</h3>
              <p md-line class="param-value">{{ applicationDetail.applicationDeployer.accountEmail }}</p>
            </md-list-item>
          </span>
          <span *ngIf="!applicationDetail.applicationDeployer.isShared && applicationDetail.applicationDeployer.sharedWithAccountEmails.length>0">
            <md-list-item>
              <h3 md-line>Shared with</h3>
              <p *ngFor="let accountEmail of applicationDetail.applicationDeployer.sharedWithAccountEmails" md-line class="param-value">{{ accountEmail }}<button md-icon-button color="warn" (click)="applicationDetail.unshare(accountEmail)">
                <md-icon>highlight_off</md-icon> 
              </button></p>
            </md-list-item>
          </span>
          <span *ngIf="applicationDetail.applicationDeployer.sharedWithTeamNames && applicationDetail.applicationDeployer.sharedWithTeamNames.length>0">
            <md-list-item>
              <h3 md-line>Included in teams</h3>
              <p *ngFor="let teamName of applicationDetail.applicationDeployer.sharedWithTeamNames" md-line class="param-value">{{ teamName }}
                <button *ngIf="!applicationDetail.applicationDeployer.isShared" md-icon-button color="warn" (click)="applicationDetail.unshare(teamName)">
                  <md-icon>highlight_off</md-icon> 
                </button>
              </p>
            </md-list-item>
          </span>
        </md-list>
        </span>
        <span class="share-application-dialog" *ngIf="applicationDetail.shareApplicationDialogShowing" open>
          <md-card>
            <md-card-header>
              <md-card-title>
                <h3>Share application</h3>
              </md-card-title>
            </md-card-header>
            <md-card-content>
              <form>
                <md-input type="url" placeholder="Share with (required)" [(ngModel)]="accountEmail" name="accountEmail" autofocus>
                </md-input>
              </form>
            </md-card-content>
            <md-card-actions align="end">
              <button md-button (click)="applicationDetail.share(accountEmail); applicationDetail.shareApplicationDialogShowing = false">
              ADD</button>
            </md-card-actions>
          </md-card>
        </span>
      </span>
      <md-list>
        <!--Application required volumes-->
        <h3 md-header>Volumes</h3>
        <md-divider></md-divider>
        <p md-subheader *ngIf="applicationDetail.applicationDeployer.volumes.length==0">This application requires no attached volumes</p>
        <!--<p md-subheader *ngIf="applicationDetail.applicationDeployer.volumes.length>0">This application requires to attach the following volumes</p>-->
        <md-list-item *ngFor="let aVolume of applicationDetail.applicationDeployer.volumes">
          <h3 md-line>{{ aVolume }}</h3>
          <select md-line (change)="applicationDetail.attachVolume(applicationDetail.applicationDeployer, aVolume, $event.target.value)">
            <option value="null">None</option>
            <option *ngFor="let volumeInstance of applicationDetail.volumeInstances" [value]="volumeInstance.reference">{{volumeInstance.reference}}</option>
          </select>
        </md-list-item>
        <!--Application required inputs-->
        <h3 md-header>Inputs</h3>
        <md-divider></md-divider>
        <p md-subheader *ngIf="applicationDetail.applicationDeployer.inputs.length==0">This application requires no input values</p>
        <md-list-item *ngFor="let anInput of applicationDetail.applicationDeployer.inputs">
          <md-input #{{anInput}} placeholder="{{ anInput }}" 
            (keyup.enter)="applicationDetail.assignInput(applicationDetail.applicationDeployer, anInput, $event.target.value)"
            (blur)="applicationDetail.assignInput(applicationDetail.applicationDeployer, anInput, $event.target.value)">
            <!--<span md-prefix>[some other hint]</span>-->
            <!--<span md-suffix>[value type]</span>-->
            <!--<md-hint align="end">[some other hint]</md-hint>-->
          </md-input>
        </md-list-item>
       
        <span *ngFor="let aCloudProvider of applicationDetail.applicationDeployer.cloudProviders">
          <span *ngIf="applicationDetail.cloudProviderParametersService.currentlySelectedCloudProviderParameters && aCloudProvider.cloudProvider==applicationDetail.cloudProviderParametersService.currentlySelectedCloudProviderParameters.cloudProvider">
            <md-list-item *ngFor="let anInput of aCloudProvider.inputs">
              <md-input #{{anInput}} placeholder="{{ anInput }}" 
                (keyup.enter)="applicationDetail.assignInput(applicationDetail.applicationDeployer, anInput, $event.target.value)"
                (blur)="applicationDetail.assignInput(applicationDetail.applicationDeployer, anInput, $event.target.value)">
                <!--<span md-prefix>[some other hint]</span>-->
                <!--<span md-suffix>[value type]</span>-->
                <!--<md-hint align="end">[some other hint]</md-hint>-->
              </md-input>
            </md-list-item>
          </span>
        </span>
        <br>

       <h3 md-header>Choose Configurations</h3>
       <md-divider></md-divider>
       <br/>
       <p md-subheader *ngIf="applicationDetail.applicationDeployer.configurations.length==0">The user account has no pre set configurations</p>
       <md-input-container>
       <select class='configuration' (change)="applicationDetail.addConfiguration(applicationDetail.applicationDeployer,$event.target.value)">
         <option>Select Configuration</option>
          <option *ngFor="let config of applicationDetail.applicationDeployer.configurations" [ngValue]="config">
                    {{config}}
          </option>
        </select>
       </md-input-container>
       
      	<h3 md-header>Deployment Parameters
            <button md-icon-button color="primary" (click)="parametersShowing=!parametersShowing">
              <md-icon>visibility</md-icon> 
            </button>
        </h3>
        <md-divider></md-divider>
        <p md-subheader *ngIf="applicationDetail.applicationDeployer.deploymentParameters.length==0">This application requires no deployment
        parameters </p>
        <md-list *ngIf="parametersShowing">
        <md-list-item  *ngFor="let assignedParameter of applicationDetail.applicationDeployer.assignedParameters| mapToIterable">
            <h3 md-line>{{ assignedParameter.key}}</h3>
            <p md-line class="param-value">{{ assignedParameter.value }}</p>
        </md-list-item>
        </md-list>
        <md-divider></md-divider>
        
         <!--Application outputs-->
        <h3 md-header>Outputs</h3>
        <md-divider></md-divider>
        <p md-subheader *ngIf="applicationDetail.applicationDeployer.outputs.length==0">This application generates no output</p>
        <p md-subheader *ngIf="applicationDetail.applicationDeployer.outputs.length>0">This application will generate the following values</p>
        <md-list-item *ngFor="let anOutput of applicationDetail.applicationDeployer.outputs">
          <li>{{ anOutput }}</li>
        </md-list-item>
      </md-list>
      <md-divider></md-divider>
    </md-card-content>

    <!--A progress bar-->
    <md-progress-bar *ngIf="applicationDetail.applicationDeployer.deploying || applicationDetail.applicationDeployer.destroying" mode="indeterminate"></md-progress-bar>
    
    <!--These are the action controls-->
    <md-card-actions *ngIf="!applicationDetail.applicationDeployer.deploying && !applicationDetail.applicationDeployer.destroying">
      <button md-raised-button 
      (click)="applicationDetail.deployApplication(applicationDetail.applicationDeployer)"
      [disabled]="!applicationDetail.cloudProviderParametersService.currentlySelectedCloudProviderParameters">
          DEPLOY
      </button>
      <span  md-line class="param-value" *ngIf="!applicationDetail.cloudProviderParametersService.currentlySelectedCloudProviderParameters" disabled>
        A valid Cloud Provider needs to be selected in order to deploy this application
      </span>
    </md-card-actions>
  </md-card>
  </div>
</cp-application-component>