<cp-deployment-component #deploymentDetail>
  <div class="content">
    <div class="detail-card-container">
      <md-card *ngIf="deploymentDetail.deploymentInstance">

        <span class="md-toolbar flex-container-wide">
          <md-icon *ngIf="deploymentDetail.deploymentInstance.status == 'STARTING_FAILED'" class="card-type-icon">error</md-icon>
          <md-icon *ngIf="deploymentDetail.deploymentInstance.status == 'DESTROYED'" class="card-type-icon">cloud_off</md-icon>
          <md-icon *ngIf="deploymentDetail.deploymentInstance.status == 'DESTROYING' || deploymentDetail.deploymentInstance.status == 'STARTING'"
            class="card-type-icon">cloud_queue</md-icon>
          <md-icon *ngIf="deploymentDetail.deploymentInstance.status == 'RUNNING'" class="card-type-icon">cloud_done</md-icon>
          <h3>{{ deploymentDetail.deploymentInstance.applicationName }}</h3>
          <p>{{ deploymentDetail.deploymentInstance.reference }}</p>
          <span class="fill-remaining-space"></span>
          <button md-icon-button *ngIf="deploymentDetail.deploymentInstance.status == 'DESTROYED'" color="warn" (click)="deploymentDetail.deleteDeployment(deploymentDetail.deploymentInstance)">
            <md-icon>delete_forever</md-icon>
          </button>
          <button md-icon-button *ngIf="deploymentDetail.deploymentInstance.status != 'DESTROYED'" disabled>
            <md-icon>delete_forever</md-icon>
          </button>
        </span>


        <md-card-content>
          <md-list dense>
            <!--Deployment meta-data-->
            <md-list-item>
              <h3 md-line>State</h3>
              <p md-line class="param-value">{{ deploymentDetail.deploymentInstance.status }}</p>
            </md-list-item>
            <md-list-item>
              <h3 md-line>Cloud Provider</h3>
              <p md-line class="param-value">{{ deploymentDetail.deploymentInstance.cloudProviderParameters.name }}</p>
            </md-list-item>
            <md-list-item *ngIf="deploymentDetail.deploymentInstance.status == 'STARTING'">
              <p md-line class="param-value">Waiting for provider data...</p>
            </md-list-item>
            <md-list-item *ngIf="deploymentDetail.deploymentInstance.status == 'STARTING_FAILED' || deploymentDetail.deploymentInstance.status == 'DESTROYING_FAILED'">
              <p md-line class="param-value">This deployment failed and there is no provider data</p>
            </md-list-item>
            <md-list-item>
              <h3 md-line *ngIf="deploymentDetail.deploymentInstance.providerId">Provider ID</h3>
              <p md-line class="param-value">{{ deploymentDetail.deploymentInstance.providerId }}</p>
            </md-list-item>
            <md-list-item *ngIf="deploymentDetail.deploymentInstance.accessIp">
              <h3 md-line>Access IP</h3>
              <p md-line class="param-value">{{ deploymentDetail.deploymentInstance.accessIp }}</p>
            </md-list-item>
          </md-list>

          <!-- Deployment inputs and co -->
          <md-list>
            <!--List attached volumes-->
            <h3 md-header>Volumes</h3>
            <p md-subheader *ngIf="deploymentDetail.deploymentInstance.attachedVolumes.length==0">There are no attached volumes for this deployment</p>
            <md-list-item *ngFor="let attachedVolume of deploymentDetail.deploymentInstance.attachedVolumes">
              <md-icon md-list-icon>storage</md-icon>
              <h3 md-line>{{ attachedVolume.name }}</h3>
              <h4 md-line class="param-value">attached to {{ attachedVolume.volumeInstanceReference }}</h4>
            </md-list-item>
            <!--List assigned inputs-->
            <h3 md-header>Inputs</h3>
            <p md-subheader *ngIf="deploymentDetail.deploymentInstance.assignedInputs.length==0">There are no assigned inputs for this deployment</p>
            <md-list-item *ngFor="let assignedInput of deploymentDetail.deploymentInstance.assignedInputs">
              <md-icon md-list-icon>keyboard_arrow_right</md-icon>
              <h3 md-line>{{ assignedInput.inputName }}</h3>
              <h4 md-line class="param-value">{{ assignedInput.assignedValue }}</h4>
            </md-list-item>
            <!--List generated outputs-->
            <h3 md-header>Outputs</h3>
            <p md-subheader *ngIf="deploymentDetail.deploymentInstance.generatedOutputs.length==0">There are no generated outputs for this deployment</p>
            <md-list-item *ngFor="let generatedOutput of deploymentDetail.deploymentInstance.generatedOutputs">
              <md-icon md-list-icon>keyboard_arrow_left</md-icon>
              <h3 md-line>{{ generatedOutput.outputName }}</h3>
              <h4 md-line class="param-value">{{ generatedOutput.generatedValue }}</h4>
            </md-list-item>
            <!--List assigned parameters-->
            <h3 md-header>Deployment parameters</h3>
            <p md-subheader *ngIf="deploymentDetail.deploymentInstance.assignedParameters.length==0">There are no assigned parameters for this deployment</p>
            <md-list-item *ngFor="let assignedParameter of deploymentDetail.deploymentInstance.assignedParameters">
              <md-icon *ngIf="!assignedParameter.parameterValue" md-list-icon>warning</md-icon>
              <md-icon *ngIf="assignedParameter.parameterValue" md-list-icon>settings_applications</md-icon>
              <h3 md-line>{{ assignedParameter.parameterName }}</h3>
              <h4 *ngIf="!assignedParameter.parameterValue" md-line class="param-value">Value not assigned</h4>
              <h4 md-line class="param-value">{{ assignedParameter.parameterValue }}</h4>
            </md-list-item>
            <!--Logs-->
            <h3 md-header>Deployment logs
              <button md-icon-button color="primary" (click)="logsShowing=!logsShowing">
              <md-icon>visibility</md-icon> 
            </button>
            </h3>
            <span class="logs-text-area" md-subheader *ngIf="logsShowing"
            innerHTML="{{ansiToHtml(deploymentDetail.deploymentInstance.logs) }}">
            </span>
          </md-list>
        </md-card-content>

        <md-progress-bar *ngIf="deploymentDetail.deploymentInstance.status == 'DESTROYING' || deploymentDetail.deploymentInstance.status == 'STARTING'"
          mode="indeterminate"></md-progress-bar>

        <md-card-actions *ngIf="deploymentDetail.deploymentInstance.status != 'DESTROYING' && deploymentDetail.deploymentInstance.status != 'STARTING'">
          <button *ngIf="deploymentDetail.deploymentInstance.status != 'DESTROYED'" md-raised-button (click)="deploymentDetail.destroyDeployment(deploymentDetail.deploymentInstance)">
          DESTROY
        </button>
          <button *ngIf="deploymentDetail.deploymentInstance.status == 'DESTROYED'" md-raised-button disabled>
          DESTROY
        </button>
        </md-card-actions>
      </md-card>
    </div>
  </div>
</cp-deployment-component>